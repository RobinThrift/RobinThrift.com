<!DOCTYPE html>
<html lang="en-gb">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://robinthrift.com/index.xml">
    <meta content="" name="keywords">
    <meta content="Metalsmith Part 3: Refining Our Tools - Robin Thrift" property="og:title">
    <title>Metalsmith Part 3: Refining Our Tools | Robin Thrift</title>
    <link rel="stylesheet" href="https://robinthrift.com/css/style.css">
</head>


<body class="antialiased text-slate-500 dark:text-slate-300 bg-white dark:bg-slate-950">
    <div class="container py-4 mb-10 mt-10">  
    <nav class="flex">
        <a class="flex-auto text-3xl text-inherit" href="https://robinthrift.com/"><h1>Robin Thrift</h1></a>
        <nav class="flex">
            
            <a class="text-inherit px-2 last:pe-0 first:ps-0" href="https://github.com/RobinThrift">
                <svg
                    width="24"
                    height="24"
                    aria-label="github"
                >
                    <use xlink:href="/img/social.map.svg#github"/>
                </svg>
            </a>
            
            <a class="text-inherit px-2 last:pe-0 first:ps-0" href="https://hachyderm.io/@RobinThrift">
                <svg
                    width="24"
                    height="24"
                    aria-label="mastodon"
                >
                    <use xlink:href="/img/social.map.svg#mastodon"/>
                </svg>
            </a>
            
            <a class="text-inherit px-2 last:pe-0 first:ps-0" href="/index.xml">
                <svg
                    width="24"
                    height="24"
                    aria-label="rss"
                >
                    <use xlink:href="/img/social.map.svg#rss"/>
                </svg>
            </a>
            
        </nav>
    </nav>
</div>

    <main class="container">
        <time class="text-sm text-slate-600 dark:text-slate-400">April 17, 2014</time>
        <h1 class="text-2xl mb-2 dark:text-slate-300">Metalsmith Part 3: Refining Our Tools</h1>
        
        <article class="prose dark:prose-invert max-w-none mt-4">
            <p><a href="https://robinthrift.com/posts/metalsmith-part-2-shaping-the-metal/">Last time</a> we took a dive into collections and Metalsmiths internals. This time we are going to refine our script and even develop our own little plugin.</p>
<p>Without wasting any time, let&rsquo;s get started!</p>
<h3 id="writing-plugins">Writing Plugins</h3>
<p>I am going to start this tutorial off with a little plugin, that will save us a time, and automate our build process further. In order to render our posts correctly, we have to set every posts template individually. As most posts will likely have the same template, this is a little unnecessary, and error prone. So let&rsquo;s change that.</p>
<p>Firstly a little reminder, how Metalsmith represents files internally:</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span><span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">2</span><span>    <span style="color:#a6d189">&#39;title&#39;</span><span style="color:#99d1db">:</span> <span style="color:#a6d189">&#39;FROM_THE_TITLE_KEY&#39;</span><span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">3</span><span>    <span style="color:#a6d189">&#39;template&#39;</span><span style="color:#99d1db">:</span> <span style="color:#a6d189">&#39;TEMPLATE_NAME&#39;</span><span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">4</span><span>    <span style="color:#a6d189">&#39;contents&#39;</span><span style="color:#99d1db">:</span> <span style="color:#99d1db">&lt;</span><span style="color:#babbf1">Buffer</span><span style="color:#c6d0f5">()</span><span style="color:#99d1db">&gt;</span><span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">5</span><span>    <span style="color:#a6d189">&#39;mode&#39;</span><span style="color:#99d1db">:</span> <span style="color:#a6d189">&#39;HEX_FILE_PERM_CODE&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">6</span><span><span style="color:#c6d0f5">}</span>
</span></span></code></pre></div><p>And Metalsmith passes an object with all the files to every function that is passed to <code>.use()</code>. But that&rsquo;s not all, Metalsmith also passes you the current Metalsmith instance and a function to call, when you&rsquo;re done, so a full plugin would look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span><span style="color:#ca9ee6">var</span> <span style="color:#babbf1">plugin</span> <span style="color:#99d1db">=</span> <span style="color:#ca9ee6">function</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">files</span><span style="color:#c6d0f5">,</span> <span style="color:#babbf1">metalsmith</span><span style="color:#c6d0f5">,</span> <span style="color:#babbf1">done</span><span style="color:#c6d0f5">)</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">2</span><span>    <span style="color:#babbf1">console</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">log</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">files</span><span style="color:#c6d0f5">);</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">3</span><span>    <span style="color:#babbf1">done</span><span style="color:#c6d0f5">();</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">4</span><span><span style="color:#c6d0f5">};</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">6</span><span><span style="color:#babbf1">Metalsmith</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">__dirname</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">7</span><span>    <span style="color:#626880;font-style:italic">//...
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">8</span><span><span style="color:#626880;font-style:italic"></span>    <span style="color:#c6d0f5">.</span><span style="color:#babbf1">use</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">plugin</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">9</span><span>    <span style="color:#626880;font-style:italic">//...
</span></span></span></code></pre></div><!-- raw HTML omitted -->
<p>As you can probably guess, this will simply log all the files to the console. Go ahead and try it, it will give you a feel about how Metalsmith works.</p>
<p>Before we go on, we should modify out plugin to return a function. This allows us to pass the plugin a configuration object (and use it multiple times with different configs):</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span><span style="color:#ca9ee6">var</span> <span style="color:#babbf1">findTemplate</span> <span style="color:#99d1db">=</span> <span style="color:#ca9ee6">function</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">config</span><span style="color:#c6d0f5">)</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">2</span><span>    <span style="color:#ca9ee6">return</span> <span style="color:#ca9ee6">function</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">files</span><span style="color:#c6d0f5">,</span> <span style="color:#babbf1">metalsmith</span><span style="color:#c6d0f5">,</span> <span style="color:#babbf1">done</span><span style="color:#c6d0f5">)</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">3</span><span>        <span style="color:#626880;font-style:italic">//...
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">4</span><span><span style="color:#626880;font-style:italic"></span>        <span style="color:#babbf1">done</span><span style="color:#c6d0f5">();</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">5</span><span>    <span style="color:#c6d0f5">};</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">6</span><span><span style="color:#c6d0f5">};</span>
</span></span></code></pre></div><p>We want our plugin to add a template key to our posts (if there is none), so we&rsquo;ll need to filter out our posts first. We will do so, by looping over the files list and use a regular expression to check if the file is a post:</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 1</span><span><span style="color:#ca9ee6">var</span> <span style="color:#babbf1">findTemplate</span> <span style="color:#99d1db">=</span> <span style="color:#ca9ee6">function</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">config</span><span style="color:#c6d0f5">)</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 2</span><span>    <span style="color:#ca9ee6">var</span> <span style="color:#babbf1">pattern</span> <span style="color:#99d1db">=</span> <span style="color:#ca9ee6">new</span> <span style="color:#c6d0f5;font-style:italic">RegExp</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">config</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">pattern</span><span style="color:#c6d0f5">);</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 4</span><span>    <span style="color:#ca9ee6">return</span> <span style="color:#ca9ee6">function</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">files</span><span style="color:#c6d0f5">,</span> <span style="color:#babbf1">metalsmith</span><span style="color:#c6d0f5">,</span> <span style="color:#babbf1">done</span><span style="color:#c6d0f5">)</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 5</span><span>        <span style="color:#ca9ee6">for</span> <span style="color:#c6d0f5">(</span><span style="color:#ca9ee6">var</span> <span style="color:#babbf1">file</span> <span style="color:#ca9ee6">in</span> <span style="color:#babbf1">files</span><span style="color:#c6d0f5">)</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 6</span><span>            <span style="color:#ca9ee6">if</span> <span style="color:#c6d0f5">(</span><span style="color:#babbf1">pattern</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">test</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">file</span><span style="color:#c6d0f5">))</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 7</span><span>                <span style="color:#ca9ee6">var</span> <span style="color:#babbf1">_f</span> <span style="color:#99d1db">=</span> <span style="color:#babbf1">files</span><span style="color:#c6d0f5">[</span><span style="color:#babbf1">file</span><span style="color:#c6d0f5">];</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 8</span><span>                <span style="color:#ca9ee6">if</span> <span style="color:#c6d0f5">(</span><span style="color:#99d1db">!</span><span style="color:#babbf1">_f</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">template</span><span style="color:#c6d0f5">)</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 9</span><span>                    <span style="color:#babbf1">_f</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">template</span> <span style="color:#99d1db">=</span> <span style="color:#babbf1">config</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">templateName</span><span style="color:#c6d0f5">;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">10</span><span>                <span style="color:#c6d0f5">}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">11</span><span>            <span style="color:#c6d0f5">}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">12</span><span>        <span style="color:#c6d0f5">}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">13</span><span>        <span style="color:#babbf1">done</span><span style="color:#c6d0f5">();</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">14</span><span>    <span style="color:#c6d0f5">};</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">15</span><span><span style="color:#c6d0f5">};</span>
</span></span></code></pre></div><p>We can now use the plugin as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span><span style="color:#babbf1">Metalsmith</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">__dirname</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">2</span><span>    <span style="color:#626880;font-style:italic">//...
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">3</span><span><span style="color:#626880;font-style:italic"></span>    <span style="color:#c6d0f5">.</span><span style="color:#babbf1">use</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">findTemplate</span><span style="color:#c6d0f5">({</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">4</span><span>        <span style="color:#babbf1">pattern</span><span style="color:#99d1db">:</span> <span style="color:#a6d189">&#39;posts&#39;</span><span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">5</span><span>        <span style="color:#babbf1">templateName</span><span style="color:#99d1db">:</span> <span style="color:#a6d189">&#39;post.hbt&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">6</span><span>    <span style="color:#c6d0f5">}))</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">7</span><span>    <span style="color:#626880;font-style:italic">//...
</span></span></span></code></pre></div><!-- raw HTML omitted -->
<h4 id="metalsmithmetadata">metalsmith.metadata()</h4>
<p>As you can see by the example above, each plugin is also passed the current metalsmith instance. This allows you to pass around, or set, global metadata. This includes things like the collections we created in the last tutorial, but also configuration. There&rsquo;s a plugin called <a href="https://github.com/segmentio/metalsmith-metadata">metalsmith-metadata</a> that loads extra config data from a file. You could use this to set things like the base URL, similar to Jekyll&rsquo;s <code>_config.yml</code>.</p>
<h4 id="a-note-error-handling">A Note Error Handling</h4>
<p>Metalsmith uses <a href="https://github.com/segmentio/ware">ware</a> to allow for the nice chaining syntax, however, this also means we need to adapt our error handling. Firstly, if an error occurs, we shouldn&rsquo;t just throw it, we should pass it to the <code>done()</code> function as the first parameter. Like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span><span style="color:#626880;font-style:italic">//...
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">2</span><span><span style="color:#626880;font-style:italic"></span><span style="color:#babbf1">done</span><span style="color:#c6d0f5">(</span><span style="color:#ca9ee6">new</span> <span style="color:#c6d0f5;font-style:italic">Error</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#39;Oh noes!&#39;</span><span style="color:#c6d0f5">));</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">3</span><span><span style="color:#626880;font-style:italic">//...
</span></span></span></code></pre></div><p>We can then catch the error in the <code>build()</code> method. To do so, we pass it a callback, which first parameter will be the error, if any (the second parameter is a list of all the files):</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span><span style="color:#626880;font-style:italic">//...
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">2</span><span><span style="color:#626880;font-style:italic"></span>    <span style="color:#c6d0f5">.</span><span style="color:#babbf1">build</span><span style="color:#c6d0f5">(</span><span style="color:#ca9ee6">function</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">err</span><span style="color:#c6d0f5">)</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">3</span><span>        <span style="color:#ca9ee6">if</span> <span style="color:#c6d0f5">(</span><span style="color:#babbf1">err</span><span style="color:#c6d0f5">)</span> <span style="color:#c6d0f5">{</span> <span style="color:#ca9ee6">throw</span> <span style="color:#babbf1">err</span><span style="color:#c6d0f5">;</span> <span style="color:#c6d0f5">}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">4</span><span>    <span style="color:#c6d0f5">});</span>
</span></span></code></pre></div><p>Now that we&rsquo;ve got that out of the way, let us continue improving our script!</p>
<h3 id="statics">Statics</h3>
<p>Most websites (even simple ones) will need some kind of static assets, like styles, scripts or fonts. We will get to preprocessing styles and scripts in a bit, but for now, we&rsquo;ll assume that we are using good ol&rsquo; CSS and plain, old, simple, non-fancy, unsexy, no-frills-no-spills, boring, not-named-after-a-beverage JavaScript.</p>
<p>To copy over these <em>exciting</em> files we will just add them to our <code>src/</code> directory.</p>
<pre tabindex="0"><code>.
|– src/
    |– content/
    |– images/
    |– styles/
    |   |_ main.css
    |_ scripts/
        |_ main.js
|– templates/
|   |_ partials/
|– config.json
|– index.js
|_ package.json
</code></pre><p>That&rsquo;s it. Metalsmith will copy the files over, including the file structure. Done. <code>next()</code>!</p>
<h3 id="preprocessing">Preprocessing</h3>
<p>Now using plain CSS and JS is boring, SCSS and CoffeeScript are way more fun! At least, we&rsquo;ll pretend for now, because that&rsquo;s what we are going to set up now.
Firstly we will need to install the CS (<a href="https://github.com/joaoafrmartins/metalsmith-coffee">metalsmith-coffee</a>) and SCSS (<a href="https://github.com/stevenschobert/metalsmith-sass">metalsmith-sass</a>) plugins via npm:</p>
<pre tabindex="0"><code>$ npm install --save-dev metalsmith-coffee metalsmith-sass
</code></pre><p>Then require them in your build script and add them to your chain (they will filter the files themselves):</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span><span style="color:#626880;font-style:italic">//...
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">2</span><span><span style="color:#626880;font-style:italic"></span>    <span style="color:#c6d0f5">.</span><span style="color:#babbf1">use</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">sass</span><span style="color:#c6d0f5">({</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">3</span><span>        <span style="color:#babbf1">outputStyle</span><span style="color:#99d1db">:</span> <span style="color:#a6d189">&#39;compressed&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">4</span><span>    <span style="color:#c6d0f5">}))</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">5</span><span>    <span style="color:#c6d0f5">.</span><span style="color:#babbf1">use</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">coffee</span><span style="color:#c6d0f5">())</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">6</span><span><span style="color:#626880;font-style:italic">//...
</span></span></span></code></pre></div><p>Both plugins accept all the options their respective underlying plugins do. Check the docs, if in doubt.</p>
<h3 id="were-to-go-from-here">Were to go from here</h3>
<p>This time, we learnt, how to write out own little plugin and set up the rest of the &ldquo;basic&rdquo; plugins. I didn&rsquo;t include any styles here, as that would be beyond the scope of this tutorial, and with the static assets in place now, you can simply add them yourself.</p>
<p>From here, you can go anywhere with a little JavaScript, so next time I will show an example, of a more complex plugin and hopefully you will fully understand the Metalsmith ecosystem.</p>
<p>The full source code for this part of the tutorial can be found <a href="https://github.com/RobinThrift/metalsmith-tutorial/tree/END-OF-PART-3">here</a></p>

        </article>
    </main>
    <footer class="container mt-10 mb-5">
    <span class="text-xs">
        <a href="https://fixel.macpaw.com">Fixel</a> by MacPaw – <a href="https://scripts.sil.org/cms/scripts/page.php?site_id=nrsi&id=OFL">License OFL 1.1</a>,
        <a href="https://github.com/theleagueof/league-mono">LeagueMono</a> font by Tyler Finck – <a href="https://github.com/theleagueof/league-mono/blob/master/OFL.md">License OFL 1.1</a>,
        <a href="https://icons.getbootstrap.com">Bootstrap Icons</a> – <a href="https://github.com/twbs/icons/blob/main/LICENSE.md">License MIT</a>
    </span>

    <span class="block mt-3">&copy; <a href="https://github.com/RobinThrift">Robin Thrift</a> 2023</span>
</footer>

</body>
</html>
