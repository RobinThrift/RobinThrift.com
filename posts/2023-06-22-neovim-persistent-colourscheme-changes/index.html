<!DOCTYPE html>
<html lang="en-gb">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://robinthrift.com/index.xml">
    <meta content="" name="keywords">
    <meta content="Persistent Colour Scheme Changes in Neovim - Robin Thrift" property="og:title">
    <title>Persistent Colour Scheme Changes in Neovim | Robin Thrift</title>
    <link rel="stylesheet" href="https://robinthrift.com/css/style.css">
</head>


<body class="antialiased text-slate-500 dark:text-slate-300 bg-white dark:bg-slate-950">
    <div class="container py-4 mb-10 mt-10">  
    <nav class="flex">
        <a class="flex-auto text-3xl text-inherit" href="https://robinthrift.com/"><h1>Robin Thrift</h1></a>
        <nav class="flex">
            
            <a class="text-inherit px-2 last:pe-0 first:ps-0" href="https://github.com/RobinThrift">
                <svg
                    width="24"
                    height="24"
                    aria-label="github"
                >
                    <use xlink:href="/img/social.map.svg#github"/>
                </svg>
            </a>
            
            <a class="text-inherit px-2 last:pe-0 first:ps-0" href="https://hachyderm.io/@RobinThrift">
                <svg
                    width="24"
                    height="24"
                    aria-label="mastodon"
                >
                    <use xlink:href="/img/social.map.svg#mastodon"/>
                </svg>
            </a>
            
            <a class="text-inherit px-2 last:pe-0 first:ps-0" href="/index.xml">
                <svg
                    width="24"
                    height="24"
                    aria-label="rss"
                >
                    <use xlink:href="/img/social.map.svg#rss"/>
                </svg>
            </a>
            
        </nav>
    </nav>
</div>

    <main class="container">
        <time class="text-sm text-slate-600 dark:text-slate-400">June 22, 2023</time>
        <h1 class="text-2xl mb-2 dark:text-slate-300">Persistent Colour Scheme Changes in Neovim</h1>
        
        <div>
    
        <a class="text-sm text-slate-600 dark:text-slate-500 underline px-3 first:px-0 hover:text-blue-900" href="/tags/neovim">neovim</a>
    
        <a class="text-sm text-slate-600 dark:text-slate-500 underline px-3 first:px-0 hover:text-blue-900" href="/tags/alacritty">alacritty</a>
    
</div>

        
        <article class="prose dark:prose-invert max-w-none mt-4">
            <p>If you&rsquo;re too lazy to read how and why, you can skip straight to the <a href="#tldr-just-give-me-the-solution">solution</a>.</p>
<p>Say, you&rsquo;re like me—you have more than one colour scheme in your rotation. Perhaps your desk is situated next to a
beautiful window that bathes your workspace in ever-changing natural light throughout the day, especially in the summer.
This, of course, leads to the necessity of frequently having to switch colour schemes.
Thankfully(?), the clever folks behind <a href="https://github.com/nvim-telescope/telescope.nvim">telescope</a> have made it incredibly
easy to find and switch between installed colour schemes.</p>
<p>Well, I am kind of lazy sometimes, so the mere thought of making the arduous trek to my Neovim config every time I desired
a change in scenery seemed quite burdensome.</p>
<p>If you&rsquo;re using Neovim <del>correctly</del> <em>traditionally</em> you will be quitting and opening Neovim many times
a day and find that settings that are not in your config files do not persist.
Generally I find this behavior useful because it allows for specific config values in specific situations, without
Neovim messing with my meticulously crafted Lua-based config.
<strong>I</strong> however can mess with config as much as I like, so I will.</p>
<p>Now, what follows is an incredibly terrible, hacky, and downright awful way to address this issue, but hey, it works (on my machine).</p>
<h2 id="setup">Setup</h2>
<p>I use <a href="https://github.com/folke/lazy.nvim">lazy.nvim</a> for plugin management so this will focus on that, the general concept however is independent of any
specific plugin system.</p>
<p>Assuming a structure similar to the following in your Neovim config directory (e.g., <code>~/.config/nvim</code>):</p>
<pre tabindex="0"><code>.
├── init.lua # &lt;- lazy setup
└── lua
    ├── config # &lt;- regular neovim config
    │   ├── ...
    │   └── ...
    └── plugins # &lt;- cool kids plugins
        ├── ...
        ├── colours.lua # &lt;- this is where the colours are
        └── ...
</code></pre><p>Any file/directory we create in the <code>lua</code> directory should be loadable by Neovim (if you&rsquo;ve set the path accordingly).
I named the directory <code>_colour</code> to indicate that this is not normal, hacky and should not actyally ever be used. But here we are,
so let&rsquo;s also create an apporiate <code>init.lua</code> file in this hideaus directory.</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 1</span><span><span style="color:#626880;font-style:italic">-- file: lua/_colour/init.lua</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 2</span><span><span style="color:#ca9ee6">local</span> <span style="color:#babbf1">M</span> <span style="color:#99d1db">=</span> <span style="color:#c6d0f5">{}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 4</span><span><span style="color:#ca9ee6">local</span> <span style="color:#babbf1">set_colourscheme</span> <span style="color:#99d1db">=</span> <span style="color:#babbf1">require</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#34;_colour.colourscheme&#34;</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 6</span><span><span style="color:#babbf1">M.setup</span> <span style="color:#99d1db">=</span> <span style="color:#ca9ee6">function</span> <span style="color:#c6d0f5">()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 7</span><span>    <span style="color:#babbf1">set_colourscheme</span><span style="color:#c6d0f5">()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 8</span><span><span style="color:#ca9ee6">end</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">10</span><span><span style="color:#ca9ee6">return</span> <span style="color:#babbf1">M</span>
</span></span></code></pre></div><p>When requiring a Lua module (read directory) the runtime will automatically load the <code>init.lua</code> inside it. <code>lazy.nvim</code> knows how to load modules
and will automatically call any <code>setup</code> function in the table we return. This is the minimum amount of boilerplate to integrate with <code>lazy.nvim</code>.</p>
<p>The magic here is the <code>require(&quot;_colour.colourscheme&quot;)</code> which tells the Lua runtime to load <code>lua/_colour/colourscheme.lua</code> which is a minimal file that looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span><span style="color:#626880;font-style:italic">-- file: lua/_colour/colourscheme.lua</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">2</span><span><span style="color:#ca9ee6">return</span> <span style="color:#ca9ee6">function</span> <span style="color:#c6d0f5">()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">3</span><span>    <span style="color:#babbf1">vim.cmd</span> <span style="color:#a6d189">[[colorscheme terafox]]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">4</span><span><span style="color:#ca9ee6">end</span>
</span></span></code></pre></div><p>Splitting this into two files might seem like a questionable decision at first, but there&rsquo;s a (good?) reason for this I&rsquo;ll cover in the next section.</p>
<p>For now let&rsquo;s hook up this &ldquo;plugin&rdquo; to <code>lazy.nvim</code>. I have all my colour scheme plugins in a file <code>lua/pugins/colors.lua</code> (as shown above) which looks something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 1</span><span><span style="color:#ca9ee6">return</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 2</span><span>    <span style="color:#c6d0f5">{</span> <span style="color:#a6d189">&#34;EdenEast/nightfox.nvim&#34;</span><span style="color:#c6d0f5">,</span> <span style="color:#babbf1">priority</span><span style="color:#99d1db">=</span>1000 <span style="color:#c6d0f5">},</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 3</span><span>    <span style="color:#626880;font-style:italic">-- all your cool colour schemes here</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 4</span><span>    <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 5</span><span>        <span style="color:#babbf1">dir</span><span style="color:#99d1db">=</span><span style="color:#a6d189">&#34;~/.config/nvim/lua/_colour&#34;</span><span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 6</span><span>        <span style="color:#babbf1">lazy</span><span style="color:#99d1db">=</span><span style="color:#ca9ee6;font-style:italic">false</span><span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 7</span><span>        <span style="color:#babbf1">priority</span><span style="color:#99d1db">=</span>900<span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 8</span><span>        <span style="color:#babbf1">init</span> <span style="color:#99d1db">=</span> <span style="color:#ca9ee6">function</span> <span style="color:#c6d0f5">()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 9</span><span>            <span style="color:#babbf1">require</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#34;_colour&#34;</span><span style="color:#c6d0f5">).</span><span style="color:#babbf1">setup</span><span style="color:#c6d0f5">()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">10</span><span>        <span style="color:#ca9ee6">end</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">11</span><span>    <span style="color:#c6d0f5">},</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">12</span><span><span style="color:#c6d0f5">}</span>
</span></span></code></pre></div><p>The important bit is the last entry that tells <code>lazy.nvim</code> to load our plugin from the given directory (executing the <code>init.lua</code>). We have to specify the plugin to not be lazy (<code>lazy=false</code>)
and set the <code>priority</code> to be lower thatn those of the colour schemes (setting the <code>priority</code> is recommended by lazy).
Lazy will call the <code>init</code> function on startup. In this case we just call our <code>setup</code> function we defined in <code>lua/_colour/init.lua</code>.
This is all the setup we need here.</p>
<h2 id="autocmds">Autocmds</h2>
<p>Vim&rsquo;s <em>(automatic commands)(<a href="https://vimhelp.org/autocmd.txt.html">https://vimhelp.org/autocmd.txt.html</a>)</em> (or <em>autocmd</em>, see <code>:help autocmd</code>) are a super cool feature I don&rsquo;t use often enough.
It&rsquo;s basically an event system that allows you to attach callbacks to all sorts of events, opening files, writing, etc., and of course, most importantly
the <a href="https://vimhelp.org/autocmd.txt.html#ColorScheme"><code>ColorScheme</code></a> event which is triggered whenever the colour scheme was <strong>successfully</strong> changed.
We can add this to our <code>setup</code> function as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 1</span><span><span style="color:#626880;font-style:italic">-- file: lua/_colour/init.lua</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 2</span><span><span style="color:#ca9ee6">local</span> <span style="color:#babbf1">M</span> <span style="color:#99d1db">=</span> <span style="color:#c6d0f5">{}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 4</span><span><span style="color:#ca9ee6">local</span> <span style="color:#babbf1">set_colourscheme</span> <span style="color:#99d1db">=</span> <span style="color:#babbf1">require</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#34;_colour.colourscheme&#34;</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 6</span><span><span style="color:#babbf1">M.setup</span> <span style="color:#99d1db">=</span> <span style="color:#ca9ee6">function</span> <span style="color:#c6d0f5">()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 7</span><span>    <span style="color:#babbf1">set_colourscheme</span><span style="color:#c6d0f5">()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 9</span><span>    <span style="color:#babbf1">vim.api</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">nvim_create_autocmd</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#39;ColorScheme&#39;</span><span style="color:#c6d0f5">,</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">10</span><span>        <span style="color:#babbf1">callback</span> <span style="color:#99d1db">=</span> <span style="color:#ca9ee6">function</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">args</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">11</span><span>            <span style="color:#626880;font-style:italic">-- args.match is the name of the colour scheme</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">12</span><span>        <span style="color:#ca9ee6">end</span><span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">13</span><span>    <span style="color:#c6d0f5">})</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">14</span><span><span style="color:#ca9ee6">end</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">16</span><span><span style="color:#ca9ee6">return</span> <span style="color:#babbf1">M</span>
</span></span></code></pre></div><p>So now we have a way to hook into the system..&gt;</p>
<h2 id="commence-the-hackery">Commence the Hackery</h2>
<p>I&rsquo;m no Lua expert, and when faced with the possibility of a world-ending catastrophe, I wasn&rsquo;t about to waste time mastering file operations in Lua.
I took the lazy way out, shamelessly exploiting Lua&rsquo;s built-int file loading mechanism (<code>require</code>) and relying on some <del>clever</del> unix hackery to do the job.</p>
<p>All we really needed was to tweak a single section of the configuration to ensure the color scheme sticks around.
It&rsquo;s a distinctive and conveniently identifiable pattern, just begging to be manipulated with a touch of <code>sed</code> magic.</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span>$ sed -i <span style="color:#a6d189">&#39;&#39;</span> -e <span style="color:#a6d189">&#39;s/\[\[colorscheme .*\]\]/[[colorscheme terafox]]/&#39;</span> ~/.config/nvim/lua/_colour/colourscheme.lua
</span></span></code></pre></div><blockquote>
<p>NOTE: This is the BSD version of <code>sed</code>, the flags for the GNU version are slightly different, especially for the <code>-i</code> flag IIRC.</p>
</blockquote>
<p>Let&rsquo;s hook this up to the autocmd:</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span><span style="color:#babbf1">vim.api</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">nvim_create_autocmd</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#39;ColorScheme&#39;</span><span style="color:#c6d0f5">,</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">2</span><span>    <span style="color:#babbf1">callback</span> <span style="color:#99d1db">=</span> <span style="color:#ca9ee6">function</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">args</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">3</span><span>        <span style="color:#babbf1">vim.fn</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">jobstart</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#34;sed -i &#39;&#39; -e &#39;s/</span><span style="color:#8caaee">\\</span><span style="color:#a6d189">[</span><span style="color:#8caaee">\\</span><span style="color:#a6d189">[colorscheme .*</span><span style="color:#8caaee">\\</span><span style="color:#a6d189">]</span><span style="color:#8caaee">\\</span><span style="color:#a6d189">]/[[colorscheme &#34;</span> <span style="color:#99d1db">..</span> <span style="color:#babbf1">args.match</span> <span style="color:#99d1db">..</span> <span style="color:#a6d189">&#34;]]/&#39; ~/.config/nvim/lua/_colour/colourscheme.lua&#34;</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">4</span><span>    <span style="color:#ca9ee6">end</span><span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">5</span><span><span style="color:#c6d0f5">})</span>
</span></span></code></pre></div><blockquote>
<p>NOTE: Check out <a href="https://neovim.io/doc/user/builtin.html#jobstart()"><code>:help jobstart</code></a> for more info.</p>
</blockquote>
<p>Now we get back to why I split the actual vim command to set the colour scheme and the &ldquo;plugin&rdquo; into two files.
I figured it would be wiser to tinker with a file that contains minimal content, rather than having the file executing the command
end up modifying itself. That&rsquo;s just asking for trouble.</p>
<p>And that&rsquo;s kind of it. Now every time the colour scheme is changed <code>lua/_colour/colourscheme.lua</code> is updated with the new name. Nifty.</p>
<p>And if you&rsquo;re an <a href="https://github.com/alacritty/alacritty">alacritty</a> user who craves harmony between the two, continue reading onto the <a href="#bonus-alacritty">bonus section</a> for some extra snazz.</p>
<h2 id="tldr-just-give-me-the-solution">TL;DR Just Give Me the Solution</h2>
<p>Here&rsquo;s the full solution:</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 1</span><span><span style="color:#626880;font-style:italic">-- file: lua/_colour/init.lua</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 2</span><span><span style="color:#ca9ee6">local</span> <span style="color:#babbf1">M</span> <span style="color:#99d1db">=</span> <span style="color:#c6d0f5">{}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 4</span><span><span style="color:#ca9ee6">local</span> <span style="color:#babbf1">set_colourscheme</span> <span style="color:#99d1db">=</span> <span style="color:#babbf1">require</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#34;_colour.colourscheme&#34;</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 6</span><span><span style="color:#babbf1">M.setup</span> <span style="color:#99d1db">=</span> <span style="color:#ca9ee6">function</span> <span style="color:#c6d0f5">()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 7</span><span>    <span style="color:#babbf1">set_colourscheme</span><span style="color:#c6d0f5">()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 9</span><span>    <span style="color:#babbf1">vim.api</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">nvim_create_autocmd</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#39;ColorScheme&#39;</span><span style="color:#c6d0f5">,</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">10</span><span>        <span style="color:#babbf1">callback</span> <span style="color:#99d1db">=</span> <span style="color:#ca9ee6">function</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">args</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">11</span><span>            <span style="color:#babbf1">vim.fn</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">jobstart</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#34;sed -i &#39;&#39; -e &#39;s/</span><span style="color:#8caaee">\\</span><span style="color:#a6d189">[</span><span style="color:#8caaee">\\</span><span style="color:#a6d189">[colorscheme .*</span><span style="color:#8caaee">\\</span><span style="color:#a6d189">]</span><span style="color:#8caaee">\\</span><span style="color:#a6d189">]/[[colorscheme &#34;</span> <span style="color:#99d1db">..</span> <span style="color:#babbf1">args.match</span> <span style="color:#99d1db">..</span> <span style="color:#a6d189">&#34;]]/&#39; ~/.config/nvim/lua/_colour/colourscheme.lua&#34;</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">12</span><span>            <span style="color:#626880;font-style:italic">-- see bonus section for more info</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">13</span><span>            <span style="color:#626880;font-style:italic">-- vim.fn.jobstart(&#34;bash -c &#39;source location_of_functions_file &amp;&amp; set_alactritty_color &#34; .. args.match .. &#34;&#39;&#34;)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">14</span><span>        <span style="color:#ca9ee6">end</span><span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">15</span><span>    <span style="color:#c6d0f5">})</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">16</span><span><span style="color:#ca9ee6">end</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">17</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">18</span><span><span style="color:#ca9ee6">return</span> <span style="color:#babbf1">M</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span><span style="color:#626880;font-style:italic">-- file: lua/_colour/colourscheme.lua</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">2</span><span><span style="color:#ca9ee6">return</span> <span style="color:#ca9ee6">function</span> <span style="color:#c6d0f5">()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">3</span><span>    <span style="color:#babbf1">vim.cmd</span> <span style="color:#a6d189">[[colorscheme terafox]]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">4</span><span><span style="color:#ca9ee6">end</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 1</span><span><span style="color:#626880;font-style:italic">-- file: lua/plugins/colours.lua</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 2</span><span><span style="color:#ca9ee6">return</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 3</span><span>    <span style="color:#c6d0f5">{</span> <span style="color:#a6d189">&#34;EdenEast/nightfox.nvim&#34;</span><span style="color:#c6d0f5">,</span> <span style="color:#babbf1">priority</span><span style="color:#99d1db">=</span>1000 <span style="color:#c6d0f5">},</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 4</span><span>    <span style="color:#626880;font-style:italic">-- all your cool colour schemes here</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 5</span><span>    <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 6</span><span>        <span style="color:#babbf1">dir</span><span style="color:#99d1db">=</span><span style="color:#a6d189">&#34;~/.config/nvim/lua/_colour&#34;</span><span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 7</span><span>        <span style="color:#babbf1">lazy</span><span style="color:#99d1db">=</span><span style="color:#ca9ee6;font-style:italic">false</span><span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 8</span><span>        <span style="color:#babbf1">priority</span><span style="color:#99d1db">=</span>900<span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 9</span><span>        <span style="color:#babbf1">init</span> <span style="color:#99d1db">=</span> <span style="color:#ca9ee6">function</span> <span style="color:#c6d0f5">()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">10</span><span>            <span style="color:#babbf1">require</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#34;_colour&#34;</span><span style="color:#c6d0f5">).</span><span style="color:#babbf1">setup</span><span style="color:#c6d0f5">()</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">11</span><span>        <span style="color:#ca9ee6">end</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">12</span><span>    <span style="color:#c6d0f5">},</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">13</span><span><span style="color:#c6d0f5">}</span>
</span></span></code></pre></div><h2 id="bonus-alacritty">Bonus: Alacritty</h2>
<p>This entire thing actually started as way to change the alacritty theme with a simple command. This section right here represents that original idea.
A bit of background: alacritty is configured using a YAML file, e.g. at <code>~/.config/alacritty/alacritty.yaml</code>
In that file, you have the ability to define various colour schemes under the <code>schemes</code> field without actually activating them.</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 1</span><span><span style="color:#ca9ee6">schemes</span><span style="color:#c6d0f5">:</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 2</span><span><span style="color:#414559">  </span><span style="color:#ca9ee6">nightfox</span><span style="color:#c6d0f5">:</span><span style="color:#414559"> </span><span style="color:#8caaee;font-style:italic">&amp;nightfox</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 3</span><span><span style="color:#414559">    </span><span style="color:#ca9ee6">primary</span><span style="color:#c6d0f5">:</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 4</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">background</span><span style="color:#c6d0f5">:</span><span style="color:#414559"> </span><span style="color:#a6d189">&#39;0x192330&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 5</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">foreground</span><span style="color:#c6d0f5">:</span><span style="color:#414559"> </span><span style="color:#a6d189">&#39;0xcdcecf&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 6</span><span><span style="color:#414559">    </span><span style="color:#ca9ee6">normal</span><span style="color:#c6d0f5">:</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 7</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">black</span><span style="color:#c6d0f5">:</span><span style="color:#414559">   </span><span style="color:#a6d189">&#39;0x393b44&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 8</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">red</span><span style="color:#c6d0f5">:</span><span style="color:#414559">     </span><span style="color:#a6d189">&#39;0xc94f6d&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b"> 9</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">green</span><span style="color:#c6d0f5">:</span><span style="color:#414559">   </span><span style="color:#a6d189">&#39;0x81b29a&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">10</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">yellow</span><span style="color:#c6d0f5">:</span><span style="color:#414559">  </span><span style="color:#a6d189">&#39;0xdbc074&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">11</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">blue</span><span style="color:#c6d0f5">:</span><span style="color:#414559">    </span><span style="color:#a6d189">&#39;0x719cd6&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">12</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">magenta</span><span style="color:#c6d0f5">:</span><span style="color:#414559"> </span><span style="color:#a6d189">&#39;0x9d79d6&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">13</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">cyan</span><span style="color:#c6d0f5">:</span><span style="color:#414559">    </span><span style="color:#a6d189">&#39;0x63cdcf&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">14</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">white</span><span style="color:#c6d0f5">:</span><span style="color:#414559">   </span><span style="color:#a6d189">&#39;0xdfdfe0&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">15</span><span><span style="color:#414559">    </span><span style="color:#ca9ee6">bright</span><span style="color:#c6d0f5">:</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">16</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">black</span><span style="color:#c6d0f5">:</span><span style="color:#414559">   </span><span style="color:#a6d189">&#39;0x575860&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">17</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">red</span><span style="color:#c6d0f5">:</span><span style="color:#414559">     </span><span style="color:#a6d189">&#39;0xd16983&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">18</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">green</span><span style="color:#c6d0f5">:</span><span style="color:#414559">   </span><span style="color:#a6d189">&#39;0x8ebaa4&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">19</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">yellow</span><span style="color:#c6d0f5">:</span><span style="color:#414559">  </span><span style="color:#a6d189">&#39;0xe0c989&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">20</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">blue</span><span style="color:#c6d0f5">:</span><span style="color:#414559">    </span><span style="color:#a6d189">&#39;0x86abdc&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">21</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">magenta</span><span style="color:#c6d0f5">:</span><span style="color:#414559"> </span><span style="color:#a6d189">&#39;0xbaa1e2&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">22</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">cyan</span><span style="color:#c6d0f5">:</span><span style="color:#414559">    </span><span style="color:#a6d189">&#39;0x7ad5d6&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">23</span><span><span style="color:#414559">      </span><span style="color:#ca9ee6">white</span><span style="color:#c6d0f5">:</span><span style="color:#414559">   </span><span style="color:#a6d189">&#39;0xe4e4e6&#39;</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">24</span><span><span style="color:#414559">    </span><span style="color:#ca9ee6">indexed_colors</span><span style="color:#c6d0f5">:</span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">25</span><span><span style="color:#414559">      </span>- {<span style="color:#414559"> </span><span style="color:#ca9ee6">index: 16, color</span><span style="color:#c6d0f5">:</span><span style="color:#414559"> </span><span style="color:#a6d189">&#39;0xf4a261&#39;</span><span style="color:#414559"> </span>}<span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">26</span><span><span style="color:#414559">      </span>- {<span style="color:#414559"> </span><span style="color:#ca9ee6">index: 17, color</span><span style="color:#c6d0f5">:</span><span style="color:#414559"> </span><span style="color:#a6d189">&#39;0xd67ad2&#39;</span><span style="color:#414559"> </span>}<span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">27</span><span><span style="color:#414559">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">28</span><span><span style="color:#414559"></span><span style="color:#ca9ee6">colors</span><span style="color:#c6d0f5">:</span><span style="color:#414559"> </span><span style="color:#8caaee;font-style:italic">*nightfox</span><span style="color:#414559">
</span></span></span></code></pre></div><p>The <code>&amp;nightfox</code> is called an <a href="https://yaml.org/spec/1.2.2/#rule-c-anchor"><code>anchor</code></a> in YAML and allows you to reference a object somewhere else
in the document using a alias, here this would be <code>*nightfox</code>.
So we can actually have many schemas in our alacritty config with only one being active by just changing the alias that <code>colors</code> uses.</p>
<p>So you&rsquo;d think we can just do the same as above with <code>sed</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span>$ sed -i <span style="color:#a6d189">&#39;&#39;</span> -e <span style="color:#a6d189">&#34;s/^colors:.*/colors: *new_scheme_alias/&#34;</span>  ~.config/alacritty/alacritty.yml
</span></span></code></pre></div><p>However, not all schemes are available for alacritty and having incorrect config is very annoying (and also ugly) so I wrapped the call with a little
bash script that ensures the scheme is actually defined before setting it.</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span><span style="color:#ca9ee6">function</span> set_alactritty_color<span style="color:#99d1db">()</span> <span style="color:#99d1db">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">2</span><span>    <span style="color:#c6d0f5;font-style:italic">local</span> <span style="color:#babbf1">config_file</span><span style="color:#99d1db">=</span><span style="color:#a6d189">&#34;</span><span style="color:#babbf1">$HOME</span><span style="color:#a6d189">/.config/alacritty/alacritty.yml&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">3</span><span>    <span style="color:#c6d0f5;font-style:italic">local</span> <span style="color:#babbf1">found</span><span style="color:#99d1db">=</span><span style="color:#ca9ee6">$(</span>grep <span style="color:#a6d189">&#34;</span><span style="color:#babbf1">$1</span><span style="color:#a6d189">&#34;</span> <span style="color:#a6d189">&#34;</span><span style="color:#babbf1">$config_file</span><span style="color:#a6d189">&#34;</span><span style="color:#ca9ee6">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">4</span><span>    <span style="color:#ca9ee6">if</span> <span style="color:#99d1db">[</span> <span style="color:#a6d189">&#34;</span><span style="color:#babbf1">$found</span><span style="color:#a6d189">&#34;</span> <span style="color:#99d1db">]</span><span style="color:#c6d0f5">;</span> <span style="color:#ca9ee6">then</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">5</span><span>        sed -i <span style="color:#a6d189">&#39;&#39;</span> -e <span style="color:#a6d189">&#34;s/^colors:.*/colors: *</span><span style="color:#babbf1">$1</span><span style="color:#a6d189">/&#34;</span>  <span style="color:#a6d189">&#34;</span><span style="color:#babbf1">$config_file</span><span style="color:#a6d189">&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">6</span><span>    <span style="color:#ca9ee6">fi</span><span style="color:#c6d0f5">;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">7</span><span><span style="color:#99d1db">}</span>
</span></span></code></pre></div><p>I put this into a file that is always sourced when I start a bash, so the <code>set_alactritty_color</code> function is always available to me.
I also hooked this up to the autocmd that persists the Neovim colour scheme.</p>
<div class="highlight"><pre tabindex="0" style="color:#ef9f76;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">1</span><span><span style="color:#babbf1">vim.api</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">nvim_create_autocmd</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#39;ColorScheme&#39;</span><span style="color:#c6d0f5">,</span> <span style="color:#c6d0f5">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">2</span><span>    <span style="color:#babbf1">callback</span> <span style="color:#99d1db">=</span> <span style="color:#ca9ee6">function</span><span style="color:#c6d0f5">(</span><span style="color:#babbf1">args</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">3</span><span>        <span style="color:#babbf1">vim.fn</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">jobstart</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#34;sed -i &#39;&#39; -e &#39;s/</span><span style="color:#8caaee">\\</span><span style="color:#a6d189">[</span><span style="color:#8caaee">\\</span><span style="color:#a6d189">[colorscheme .*</span><span style="color:#8caaee">\\</span><span style="color:#a6d189">]</span><span style="color:#8caaee">\\</span><span style="color:#a6d189">]/[[colorscheme &#34;</span> <span style="color:#99d1db">..</span> <span style="color:#babbf1">args.match</span> <span style="color:#99d1db">..</span> <span style="color:#a6d189">&#34;]]/&#39; ~/.config/nvim/lua/_colour/colourscheme.lua&#34;</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">4</span><span>        <span style="color:#626880;font-style:italic">-- change the source argument to whever the file you added the function too</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">5</span><span>        <span style="color:#babbf1">vim.fn</span><span style="color:#c6d0f5">.</span><span style="color:#babbf1">jobstart</span><span style="color:#c6d0f5">(</span><span style="color:#a6d189">&#34;bash -c &#39;source location_of_functions_file &amp;&amp; set_alactritty_color &#34;</span> <span style="color:#99d1db">..</span> <span style="color:#babbf1">args.match</span> <span style="color:#99d1db">..</span> <span style="color:#a6d189">&#34;&#39;&#34;</span><span style="color:#c6d0f5">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">6</span><span>    <span style="color:#ca9ee6">end</span><span style="color:#c6d0f5">,</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#774f3b">7</span><span><span style="color:#c6d0f5">})</span>
</span></span></code></pre></div><p>And there you have it, the &ldquo;brilliant&rdquo; and somewhat cursed way to persist a dynamically set Neovim scheme and sync it with alacritty, if possible.</p>
<p>If you have any recommendations for improvements let me know, although now that it&rsquo;s working, I&rsquo;ll probably ignore them.</p>

        </article>
    </main>
    <footer class="container mt-10 mb-5">
    <span class="text-xs">
        <a href="https://fixel.macpaw.com">Fixel</a> by MacPaw – <a href="https://scripts.sil.org/cms/scripts/page.php?site_id=nrsi&id=OFL">License OFL 1.1</a>,
        <a href="https://github.com/theleagueof/league-mono">LeagueMono</a> font by Tyler Finck – <a href="https://github.com/theleagueof/league-mono/blob/master/OFL.md">License OFL 1.1</a>,
        <a href="https://icons.getbootstrap.com">Bootstrap Icons</a> – <a href="https://github.com/twbs/icons/blob/main/LICENSE.md">License MIT</a>
    </span>

    <span class="block mt-3">&copy; <a href="https://github.com/RobinThrift">Robin Thrift</a> 2023</span>
</footer>

</body>
</html>
